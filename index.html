<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insulin & Blood Sugar Log Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        input[type="date"],
        input[type="number"] {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input[type="date"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-save {
            background: #667eea;
            color: white;
        }

        .btn-save:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-clear {
            background: #6c757d;
            color: white;
        }

        .btn-clear:hover {
            background: #5a6268;
        }

        .logs-section {
            margin-top: 40px;
        }

        .logs-section h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        thead {
            background: #667eea;
            color: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
        }

        tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        tbody tr:hover {
            background: #e9ecef;
        }

        .calculation {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .calculation h3 {
            color: #0066cc;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            table {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“‹ Insulin & Blood Sugar Log Tracker</h1>
            Insulin & Blood Sugar Log Tracker</h1>
        
        <div class="form-section">
            <div class="form-grid">
<h1>ðŸ“‹ Insulin & Blood Sugar Log Tracker</h1>                    <label for="logDate">Date:</label>
                    <input type="date" id="logDate" required>
                </div>
                <div class="form-group">
                    <label for="bsMorning">BS Morning:</label>
                    <input type="number" id="bsMorning" placeholder="Enter value">
                </div>
                <div class="form-group">
                    <label for="lantusDose">Lantus Dose:</label>
                    <input type="number" id="lantusDose" placeholder="Enter units">
                </div>
                <div class="form-group">
                    <label for="bsBreakfast">BS Before Breakfast:</label>
                    <input type="number" id="bsBreakfast" placeholder="Enter value">
                </div>
                <div class="form-group">
                    <label for="humalogBreakfast">Humalog Breakfast:</label>
                    <input type="number" id="humalogBreakfast" placeholder="Enter units">
                </div>
                <div class="form-group">
                    <label for="bsLunch">BS Before Lunch:</label>
                    <input type="number" id="bsLunch" placeholder="Enter value">
                </div>
                <div class="form-group">
                    <label for="humalogLunch">Humalog Lunch:</label>
                    <input type="number" id="humalogLunch" placeholder="Enter units">
                </div>
                <div class="form-group">
                    <label for="bsDinner">BS Before Dinner:</label>
                    <input type="number" id="bsDinner" placeholder="Enter value">
                </div>
                <div class="form-group">
                    <label for="humalogDinner">Humalog Dinner:</label>
                    <input type="number" id="humalogDinner" placeholder="Enter units">
                </div>
                <div class="form-group">
                    <label for="bsBedtime">BS Bedtime:</label>
                    <input type="number" id="bsBedtime" placeholder="Enter value">
                </div>
            </div>

            <div class="calculation">
                                <h3>ðŸ“‹ Dosing Guidelines</h3>
                <p><strong>ðŸ“‹ LANTUS (Basal - Before Breakfast)</strong><br>
                If all last 3 days B/S > 140 mg/dL â†’ Add 4 units | If any B/S < 70 mg/dL â†’ Subtract 6 units</p>
                <p><strong>ðŸ“‹ HUMALOG (Bolus - Sliding Scale)</strong><br>
                130â€“160 mg/dL â†’ Same dose | < 130 mg/dL â†’ Minus 1 unit | > 160 mg/dL â†’ Plus 1 unit</p>v>

            <div class="button-group">
                <button class="btn-save" onclick="saveLog()">âœ… Save Log</button>                <button class="btn-clear" onclick="clearForm()">ðŸ”„ Clear Form</button>
            </div>
        </div>

        <div class="logs-section">
            <h2>>ðŸ“ˆ Previous Logs<
            <table id="logsTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>BS Morning</th>
                        <th>Lantus</th>
                        <th>BS Breakfast</th>
                        <th>H. Breakfast</th>
                        <th>BS Lunch</th>
                        <th>H. Lunch</th>
                        <th>BS Dinner</th>
                        <th>H. Dinner</th>
                        <th>BS Bedtime</th>
                    </tr>
                </thead>
                <tbody id="logsBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://lkmuujdzsuhvetpejomy.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_knmZ-Qw-KzoqcgFjndiL2A_W6CrdpuD';
        const { createClient } = window.supabase;
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Set today's date by default
        document.getElementById('logDate').valueAsDate = new Date();

        
        // Auto-calculate Humalog doses
        function calculateHumalog(bsValue) {
            if (!bsValue || bsValue <= 100) return 0;
            return Math.round((bsValue - 100) / 50);
        }

        // Auto-fill Humalog fields
        document.getElementById('bsBreakfast').addEventListener('input', function() {
            document.getElementById('humalogBreakfast').value = calculateHumalog(this.value);
        });

        document.getElementById('bsLunch').addEventListener('input', function() {
            document.getElementById('humalogLunch').value = calculateHumalog(this.value);
        });

        document.getElementById('bsDinner').addEventListener('input', function() {
            document.getElementById('humalogDinner').value = calculateHumalog(this.value);
        });

        // Save log to Supabase
        async function saveLog() {
            const logData = {
                log_date: document.getElementById('logDate').value,
                bs_morning: parseInt(document.getElementById('bsMorning').value) || null,
                lantus_dose: parseInt(document.getElementById('lantusDose').value) || null,
                bs_breakfast: parseInt(document.getElementById('bsBreakfast').value) || null,
                humalog_breakfast: parseInt(document.getElementById('humalogBreakfast').value) || null,
                bs_lunch: parseInt(document.getElementById('bsLunch').value) || null,
                humalog_lunch: parseInt(document.getElementById('humalogLunch').value) || null,
                bs_dinner: parseInt(document.getElementById('bsDinner').value) || null,
                humalog_dinner: parseInt(document.getElementById('humalogDinner').value) || null,
                bs_bedtime: parseInt(document.getElementById('bsBedtime').value) || null
            };

            if (!logData.log_date) {
                alert('Please select a date!');
                return;
            }

            const { data, error } = await supabase
                .from('insulin_logs')
                .insert([logData]);

            if (error) {
                console.error('Error saving log:', error);
                alert('Error saving log. Please try again.');
            } else {
                alert('Log saved successfully!');
                clearForm();
                loadLogs();
            }
        }

        // Load logs from Supabase
        async function loadLogs() {
            const { data, error } = await supabase
                .from('insulin_logs')
                .select('*')
                .order('log_date', { ascending: false });

            if (error) {
                console.error('Error loading logs:', error);
                return;
            }

            const tbody = document.getElementById('logsBody');
            tbody.innerHTML = '';

            data.forEach(log => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${log.log_date}</td>
                    <td>${log.bs_morning || '-'}</td>
                    <td>${log.lantus_dose || '-'}</td>
                    <td>${log.bs_breakfast || '-'}</td>
                    <td>${log.humalog_breakfast || '-'}</td>
                    <td>${log.bs_lunch || '-'}</td>
                    <td>${log.humalog_lunch || '-'}</td>
                    <td>${log.bs_dinner || '-'}</td>
                    <td>${log.humalog_dinner || '-'}</td>
                    <td>${log.bs_bedtime || '-'}</td>
                `;
            });
        }

        // Clear form
        function clearForm() {
            document.getElementById('logDate').valueAsDate = new Date();
            document.getElementById('bsMorning').value = '';
            document.getElementById('lantusDose').value = '';
            document.getElementById('bsBreakfast').value = '';
            document.getElementById('humalogBreakfast').value = '';
            document.getElementById('bsLunch').value = '';
            document.getElementById('humalogLunch').value = '';
            document.getElementById('bsDinner').value = '';
            document.getElementById('humalogDinner').value = '';
            document.getElementById('bsBedtime').value = '';
        }

        // Load logs on page load
        window.addEventListener('load', loadLogs);
    </script>
</body>
</html>
